<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="å…è´¹åœ¨çº¿ SVG ä¼˜åŒ–å’Œå‹ç¼©å·¥å…·ã€‚æ”¯æŒ SVG æ ¼å¼åŒ–ã€å‹ç¼©ã€ä¼˜åŒ–è·¯å¾„ã€ç§»é™¤å†—ä½™ä»£ç ç­‰åŠŸèƒ½ï¼Œå¤§å¹…å‡å° SVG æ–‡ä»¶å¤§å°ï¼Œæ‰€æœ‰æ•°æ®åœ¨æœ¬åœ°å¤„ç†ï¼Œå®‰å…¨å¯é ã€‚" />
    <meta name="keywords" content="SVGä¼˜åŒ–,SVGå‹ç¼©,SVGæ ¼å¼åŒ–,åœ¨çº¿SVGå·¥å…·,çŸ¢é‡å›¾ä¼˜åŒ–,æ–‡ä»¶å¤§å°ä¼˜åŒ–,SVGOMG,SVGO" />
    <meta name="author" content="YYSCèµ„æºå¯¼èˆª" />
    <meta name="robots" content="index, follow" />
    <meta name="googlebot" content="index, follow" />
    <meta name="theme-color" content="#667eea" />
    
    <title>SVG ä¼˜åŒ–å·¥å…· - å…è´¹åœ¨çº¿ SVG ä¼˜åŒ–ä¸å‹ç¼©å·¥å…·</title>

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "SVG ä¼˜åŒ–å·¥å…·",
        "description": "å…è´¹åœ¨çº¿ SVG ä¼˜åŒ–å’Œå‹ç¼©å·¥å…·ã€‚æ”¯æŒ SVG æ ¼å¼åŒ–ã€å‹ç¼©ã€ä¼˜åŒ–è·¯å¾„ã€ç§»é™¤å†—ä½™ä»£ç ç­‰åŠŸèƒ½ï¼Œå¤§å¹…å‡å° SVG æ–‡ä»¶å¤§å°ï¼Œæ‰€æœ‰æ•°æ®åœ¨æœ¬åœ°å¤„ç†ï¼Œå®‰å…¨å¯é ã€‚",
        "url": "https://example.com/svg-optimizer.html",
        "applicationCategory": "DeveloperApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "CNY"
        },
        "featureList": [
            "SVG æ ¼å¼åŒ–",
            "SVG å‹ç¼©",
            "è·¯å¾„ä¼˜åŒ–",
            "ç§»é™¤å†—ä½™ä»£ç ",
            "æ™ºèƒ½ ID æ¸…ç†",
            "æ ·å¼ä¼˜åŒ–",
            "å¯è§†åŒ–å¯¹æ¯”",
            "æœ¬åœ°å¤„ç†ï¼Œå®‰å…¨å¯é "
        ],
        "publisher": {
            "@type": "Organization",
            "name": "YYSCèµ„æºå¯¼èˆª"
        }
    }
    </script>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0iIzY2N2VlYSI+PHBhdGggZD0iTTEyIDJDNi40OCA MiAyIDYuNDggMiAxMnM0LjQ4IDEwIDEwIDEwIDEwLTQuNDggMTAtMTBTMTcuNTIgMiAxMiAyem0zLjUgMTJsLTYgMy41di03TDkuNSAxMC41IDE1LjUgMTR6bS0zLjUtMS42N2wtLjcxLS40MS0yLjggMS42MyAyLjggMS42My43MS0uNDF2LS44MXptLTYtMy41djdsNi0zLjVWOC4zM2wtNiAzLjV6bTAtMWwyLjguNDVWNy4yOEw2IDguNjZ6bTYuNSAyLjE3bC43MS40MXYyLjgybC0yLjgtMS42Mi0uNzEtLjQxVjEzLjVMMTIuNSAxMC44M3ptNi41IDMuNWwtNi0zLjV2Ny4wMWwyLjgtMS42My43MS0uNDFMMTkgMTR6bTAtMWwtMi44LS40di0yLjgyTDkgMTAuNWwyLjggMS42Mi43MS40MUwxOSA5LjY2ek0xMiA0LjQ1bDIuOCAxLjYyLTEuNzUuOTktMi44LS45OS0uMDQtLjA0IDEuNzktMS4wMnoiLz48L3N2Zz4=">
    
    <!-- 
    ============================================
    Embedded CSS for Core Functionality
    ============================================
    -->
    <style>
/* General Reset & Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 20px;
    color: #333;
    line-height: 1.6;
    position: relative;
}

.container {
    max-width: 1600px;
    margin: 0 auto;
    background: white;
    border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    overflow: hidden;
}

/* Header */
header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    text-align: center;
}

header h1 {
    font-size: 2.5em;
    margin-bottom: 10px;
    font-weight: 700;
}

header p {
    font-size: 1.1em;
    opacity: 0.9;
}

/* Main Content Layout */
.main-content {
    display: grid;
    grid-template-columns: 320px 1fr; /* Sidebar fixed width, content flexible */
    gap: 0;
    min-height: 600px;
}

/* Responsive adjustments for smaller screens */
@media (max-width: 1024px) {
    body {
        padding: 10px;
    }
    
    .main-content {
        grid-template-columns: 1fr; /* Stack sidebar and content */
    }
    .sidebar {
        border-right: none;
        border-bottom: 2px solid #e1e8ed;
        max-height: unset; /* Allow sidebar to expand */
        position: static; /* Remove sticky position on smaller screens */
    }
    .content-area {
        padding: 20px; /* Reduce padding */
    }
}

@media (max-width: 768px) {
    .preview-container {
        grid-template-columns: 1fr; /* Stack preview boxes */
    }
    header h1 {
        font-size: 2em;
    }
    header p {
        font-size: 1em;
    }
    .container {
        border-radius: 0; /* No border-radius on very small screens */
        box-shadow: none;
    }
    body {
        padding: 0; /* No padding on body */
    }
}

/* Sidebar */
.sidebar {
    background: #f7f9fc;
    border-right: 2px solid #e1e8ed;
    padding: 20px;
    overflow-y: auto;
    max-height: calc(100vh - 180px); /* Adjust based on header height, for sticky behavior */
    position: sticky;
    top: 0;
    align-self: start; /* Ensures sticky behavior starts from the top of its grid area */
}

/* Content Area */
.content-area {
    padding: 30px;
}

/* Upload Zone */
.upload-zone {
    border: 3px dashed #667eea;
    border-radius: 12px;
    padding: 40px;
    text-align: center;
    background: #f7f9fc;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 30px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 250px;
}

.upload-zone:hover {
    background: #eef2ff;
    border-color: #764ba2;
}

.upload-zone.dragover {
    background: #e0e7ff;
    border-color: #4c1d95;
}

.upload-icon {
    font-size: 4em;
    margin-bottom: 15px;
    color: #667eea;
}

.upload-zone h3 {
    color: #333;
    margin-bottom: 10px;
    font-size: 1.5em;
}

.upload-zone p {
    color: #666;
    font-size: 1.1em;
}

.hidden {
    display: none !important;
}

/* Preview Container */
.preview-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 20px;
}

.preview-box {
    border: 2px solid #e1e8ed;
    border-radius: 12px;
    padding: 20px;
    background: #f9fafb;
    display: flex;
    flex-direction: column;
}

.preview-box h3 {
    color: #333;
    margin-bottom: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 1.3em;
}

.preview-box .size-badge {
    font-size: 0.85em;
    padding: 5px 12px;
    background: #667eea;
    color: white;
    border-radius: 20px;
    font-weight: 600;
}

.preview-box .size-badge.optimized {
    background: #10b981;
}

.svg-preview {
    width: 100%;
    min-height: 250px;
    height: 100%; /* Ensure it fills parent height */
    background: white;
    border: 1px solid #e1e8ed;
    border-radius: 8px;
    padding: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden; /* Prevent SVG content from overflowing this box */
    margin-bottom: 15px;
    flex-grow: 1; /* Allow preview to grow */
}

/* For image-based SVG preview */
.svg-preview img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain; /* Ensures the entire image is visible within the container */
}

/* Statistics Section */
.stats {
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    border: 2px solid #e1e8ed;
}

.stats h3 {
    color: #333;
    margin-bottom: 15px;
    font-size: 1.4em;
    border-bottom: 1px solid #e1e8ed;
    padding-bottom: 10px;
}

.stat-item {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    font-size: 1.1em;
}

.stat-item:last-child {
    border-bottom: none;
}

.stat-label {
    color: #666;
}

.stat-value {
    color: #333;
    font-weight: 600;
}

.stat-value.positive {
    color: #10b981;
}

/* Options Sidebar Sections */
.options-section {
    margin-bottom: 25px;
    border-bottom: 1px dashed #e1e8ed;
    padding-bottom: 20px;
}

.options-section:last-of-type {
    border-bottom: none;
    padding-bottom: 0;
}

.options-section h3 {
    color: #333;
    margin-bottom: 12px;
    font-size: 1em;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 700;
}

.option-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px;
    background: white;
    border-radius: 6px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    border: 1px solid #f0f0f0;
}

.option-item:hover {
    background: #eef2ff;
    border-color: #c9d7ff;
}

.option-item label {
    display: flex;
    align-items: center;
    cursor: pointer;
    flex: 1;
    font-size: 0.95em;
    color: #333;
}

.option-item input[type="checkbox"] {
    margin-right: 10px;
    width: 18px;
    height: 18px;
    min-width: 18px;
    border: 1px solid #ccc;
    border-radius: 4px;
    cursor: pointer;
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-color: #fff;
    transition: background-color 0.2s, border-color 0.2s;
    flex-shrink: 0; /* Prevent checkbox from shrinking */
}

.option-item input[type="checkbox"]:checked {
    background-color: #667eea;
    border-color: #667eea;
}

.option-item input[type="checkbox"]:checked::before {
    content: 'âœ“';
    display: block;
    color: white;
    font-size: 14px;
    line-height: 16px;
    text-align: center;
}

.option-item input[type="number"] {
    width: 70px;
    padding: 5px 8px;
    border: 1px solid #e1e8ed;
    border-radius: 6px;
    font-size: 0.9em;
    text-align: center;
    transition: border-color 0.2s;
}

.option-item input[type="number"]:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
}

.precision-option {
    background: #f0f4ff;
    border-color: #c9d7ff;
    font-weight: 500;
}
.precision-option label {
    color: #444;
}

/* Action Buttons */
.action-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 12px 20px;
    border-radius: 8px;
    font-size: 1em;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    border: none;
    margin-right: 10px;
    margin-top: 10px;
}

.action-btn:last-child {
    margin-right: 0;
}

.primary-btn {
    background: #667eea;
    color: white;
}

.primary-btn:hover {
    background: #5a6edb;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
}

.secondary-btn {
    background: #e1e8ed;
    color: #333;
}

.secondary-btn:hover {
    background: #d4dde5;
    box-shadow: 0 4px 15px rgba(170, 180, 190, 0.3);
}

.reset-btn {
    background: #fca5a5;
    color: #7f1d1d;
    border: none;
    padding: 10px 15px;
    border-radius: 8px;
    font-size: 0.9em;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    display: block;
    width: 100%;
    margin-top: 20px;
}

.reset-btn:hover {
    background: #ef4444;
    color: white;
}

.action-buttons {
    margin-top: 30px;
    text-align: center;
}

/* Notification Pop-up */
.notification {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #333;
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    opacity: 0;
    transition: opacity 0.3s ease, bottom 0.3s ease;
    z-index: 1000;
    font-size: 0.95em;
    pointer-events: none; /* Allow clicks to pass through */
}

.notification.show {
    opacity: 1;
    bottom: 30px;
}

/* Code Editor Styles */
.code-editor-container {
    margin-top: 20px;
    background: #282c34;
    border-radius: 12px;
    overflow: hidden;
    border: 2px solid #e1e8ed;
}

.code-tabs {
    display: flex;
    border-bottom: 1px solid #444;
}

.code-tab {
    background: #3c4048;
    color: #ccc;
    padding: 10px 20px;
    border: none;
    border-right: 1px solid #444;
    cursor: pointer;
    font-size: 0.95em;
    transition: background-color 0.2s, color 0.2s;
    flex-grow: 1; /* Distribute tabs evenly */
    text-align: center;
}

.code-tab:last-child {
    border-right: none;
}

.code-tab.active {
    background: #282c34;
    color: #fff;
    font-weight: 600;
}

.code-editor-wrapper {
    position: relative;
    height: 400px; /* Fixed height for code editors */
}

.code-editor {
    width: 100%;
    height: 100%;
    border: none;
    background: #282c34;
    color: #f8f8f2;
    padding: 20px;
    font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
    font-size: 0.9em;
    line-height: 1.5;
    resize: none;
    overflow: auto;
    white-space: pre;
    box-sizing: border-box;
    position: absolute; /* Stack textareas */
    top: 0;
    left: 0;
}
</style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¨ SVG ä¼˜åŒ–å·¥å…·</h1>
            <p>å¼ºå¤§çš„ SVG ä¼˜åŒ–ä¸å‹ç¼©å·¥å…·</p>
        </header>

        <div class="main-content">
            <!-- ä¾§è¾¹æ  - ä¼˜åŒ–é€‰é¡¹ -->
            <aside class="sidebar">
                <div class="options-section">
                    <h3>ğŸ”§ åŸºç¡€ä¼˜åŒ–</h3>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" id="removeDoctype" checked>
                            ç§»é™¤ DOCTYPE å£°æ˜
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" id="removeXMLProcInst" checked>
                            ç§»é™¤ XML å¤„ç†æŒ‡ä»¤
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" id="removeComments" checked>
                            ç§»é™¤æ³¨é‡Š
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" id="removeMetadata" checked>
                            ç§»é™¤å…ƒæ•°æ®
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" id="removeEditorsNSData" checked>
                            ç§»é™¤ç¼–è¾‘å™¨å‘½åç©ºé—´
                        </label>
                    </div>
                </div>

                <div class="options-section">
                    <h3>âœ¨ é«˜çº§ä¼˜åŒ–</h3>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" id="removeEmptyAttrs" checked>
                            ç§»é™¤ç©ºå±æ€§
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" id="removeHiddenElems" checked>
                            ç§»é™¤éšè—å…ƒç´ 
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" id="removeEmptyContainers" checked>
                            ç§»é™¤ç©ºå®¹å™¨
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" id="cleanupIDs" checked>
                            æ¸…ç† ID
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" id="removeUselessDefs" checked>
                            ç§»é™¤æ— ç”¨å®šä¹‰
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" id="cleanupNumericValues" checked>
                            æ¸…ç†æ•°å­—å€¼ (ä¾‹å¦‚: 1.0 -> 1)
                        </label>
                    </div>
                </div>

                <div class="options-section">
                    <h3>ğŸ“ è·¯å¾„ä¼˜åŒ–</h3>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" id="convertPathData" checked>
                            ä¼˜åŒ–è·¯å¾„æ•°æ®
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" id="convertShapeToPath">
                            è½¬æ¢å½¢çŠ¶ä¸ºè·¯å¾„
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" id="mergePaths" checked>
                            åˆå¹¶è·¯å¾„
                        </label>
                    </div>
                    <div class="option-item precision-option">
                        <label>
                            ç²¾åº¦æ§åˆ¶
                        </label>
                        <input type="number" id="precision" min="0" max="10" value="3">
                    </div>
                </div>

                <div class="options-section">
                    <h3>ğŸ¨ æ ·å¼ä¼˜åŒ–</h3>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" id="removeUnusedNS" checked>
                            ç§»é™¤æœªä½¿ç”¨çš„å‘½åç©ºé—´
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" id="cleanupAttrs" checked>
                            æ¸…ç†å±æ€§
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" id="minifyStyles" checked>
                            å‹ç¼©æ ·å¼
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" id="removeStyleElement">
                            ç§»é™¤ style å…ƒç´ 
                        </label>
                    </div>
                </div>

                <div class="options-section">
                    <h3>ğŸ“ è¾“å‡ºæ ¼å¼</h3>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" id="prettyPrint">
                            æ ¼å¼åŒ–è¾“å‡ºï¼ˆä¾¿äºé˜…è¯»ï¼Œä¼šå¢åŠ æ–‡ä»¶å¤§å°ï¼‰
                        </label>
                    </div>
                </div>

                <button class="reset-btn" id="resetOptions">
                    ğŸ”„ é‡ç½®é€‰é¡¹
                </button>
            </aside>

            <!-- ä¸»å†…å®¹åŒº -->
            <main class="content-area">
                <!-- ä¸Šä¼ åŒºåŸŸ -->
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">ğŸ“</div>
                    <h3>æ‹–æ”¾ SVG æ–‡ä»¶åˆ°æ­¤å¤„</h3>
                    <p>æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                    <input type="file" id="fileInput" accept=".svg,image/svg+xml" class="hidden">
                </div>

                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                <div class="stats hidden" id="stats">
                    <h3>ğŸ“Š ä¼˜åŒ–ç»Ÿè®¡</h3>
                    <div class="stat-item">
                        <span class="stat-label">åŸå§‹å¤§å°</span>
                        <span class="stat-value" id="originalSize">0 KB</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ä¼˜åŒ–åå¤§å°</span>
                        <span class="stat-value positive" id="optimizedSize">0 KB</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">èŠ‚çœç©ºé—´</span>
                        <span class="stat-value positive" id="savedSize">0 KB (0%)</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">å¤„ç†æ—¶é—´</span>
                        <span class="stat-value" id="processTime">0 ms</span>
                    </div>
                </div>

                <!-- é¢„è§ˆåŒºåŸŸ -->
                <div class="preview-container hidden" id="previewContainer">
                    <div class="preview-box">
                        <h3>
                            åŸå§‹ SVG
                            <span class="size-badge" id="originalBadge">0 KB</span>
                        </h3>
                        <div class="svg-preview" id="originalPreview"></div>
                        <button class="action-btn secondary-btn" id="copyOriginal">
                            ğŸ“‹ å¤åˆ¶åŸå§‹ä»£ç 
                        </button>
                    </div>

                    <div class="preview-box">
                        <h3>
                            ä¼˜åŒ–å SVG
                            <span class="size-badge optimized" id="optimizedBadge">0 KB</span>
                        </h3>
                        <div class="svg-preview" id="optimizedPreview"></div>
                        <button class="action-btn primary-btn" id="copyOptimized">
                            ğŸ“‹ å¤åˆ¶ä¼˜åŒ–ä»£ç 
                        </button>
                    </div>
                </div>

                <!-- ä»£ç ç¼–è¾‘å™¨ -->
                <div class="code-editor-container hidden" id="codeEditorContainer">
                    <div class="code-tabs">
                        <button class="code-tab active" data-tab="original">åŸå§‹ä»£ç </button>
                        <button class="code-tab" data-tab="optimized">ä¼˜åŒ–ä»£ç </button>
                    </div>
                    <div class="code-editor-wrapper">
                        <textarea class="code-editor" id="originalCode" readonly></textarea>
                        <textarea class="code-editor hidden" id="optimizedCode" readonly></textarea>
                    </div>
                </div>

                <!-- æ“ä½œæŒ‰é’® -->
                <div class="action-buttons hidden" id="actionButtons">
                    <button class="action-btn primary-btn" id="downloadOptimized">
                        â¬‡ï¸ ä¸‹è½½ä¼˜åŒ–åçš„ SVG
                    </button>
                    <button class="action-btn secondary-btn" id="downloadOriginal">
                        â¬‡ï¸ ä¸‹è½½åŸå§‹ SVG
                    </button>
                    <button class="action-btn secondary-btn" id="loadNew">
                        ğŸ”„ åŠ è½½æ–°æ–‡ä»¶
                    </button>
                </div>
            </main>
        </div>
    </div>

    <!-- é€šçŸ¥æç¤º -->
    <div class="notification hidden" id="notification">
        <span id="notificationText"></span>
    </div>

    <!-- 
    ============================================
    Embedded JavaScript for Core Functionality
    ============================================
    -->
    <!-- SVGO Library from CDN - This is required for the tool to work -->
    <script src="https://unpkg.com/svgo@3.3.2/dist/svgo.browser.js" 
            onerror="console.warn('SVGO 3.3.2 åŠ è½½å¤±è´¥ï¼Œå°è¯•å…¶ä»–ç‰ˆæœ¬')"></script>
    <script>
        // æ£€æŸ¥ SVGO æ˜¯å¦åŠ è½½æˆåŠŸ
        if (typeof SVGO === 'undefined') {
            console.warn('SVGO æœªåŠ è½½ï¼Œå°†ä½¿ç”¨å¢å¼ºçš„æ¨¡æ‹Ÿä¼˜åŒ–å‡½æ•°');
        }
    </script>
    
    <script>
// script.js

// âš ï¸ å®‰å…¨è€ƒè™‘ï¼šç›´æ¥å°†ç”¨æˆ·æä¾›çš„ SVG ä½œä¸º innerHTML æ’å…¥ DOM å­˜åœ¨æ½œåœ¨çš„ XSS é£é™©ã€‚
//    ä¸ºæé«˜å®‰å…¨æ€§ï¼Œè¿™é‡Œåœ¨é¢„è§ˆæ—¶ä½¿ç”¨ `<img>` æ ‡ç­¾ç»“åˆ Data URIã€‚
//    è¿™èƒ½æœ‰æ•ˆéš”ç¦»æ½œåœ¨çš„æ¶æ„è„šæœ¬ï¼Œä½†ä¼šå¤±å» SVG çš„äº¤äº’æ€§ã€‚
//    å¦‚æœéœ€è¦äº¤äº’å¼é¢„è§ˆï¼Œå¯ä»¥è€ƒè™‘æ²™ç›’ iframeã€‚

// æ£€æŸ¥ SVGO æ˜¯å¦å·²å…¨å±€å¯ç”¨
// SVGO ä¸åŒç‰ˆæœ¬çš„æµè§ˆå™¨ API å¯èƒ½ä¸åŒ
let SVGO_optimize = null;
let SVGO_loaded = false;

// ç­‰å¾… DOM åŠ è½½å®Œæˆåå†æ£€æŸ¥ SVGO
function initSVGO() {
    if (typeof SVGO !== 'undefined') {
        // SVGO 3.x API: SVGO.optimize(svgString, config)
        if (typeof SVGO.optimize === 'function') {
            SVGO_optimize = SVGO.optimize.bind(SVGO);
            SVGO_loaded = true;
            console.log('âœ“ SVGO å·²åŠ è½½ï¼ˆç‰ˆæœ¬ 3.xï¼‰');
        }
        // SVGO 2.x æˆ–å…¶ä»–æ ¼å¼
        else if (typeof SVGO.default !== 'undefined') {
            if (typeof SVGO.default.optimize === 'function') {
                SVGO_optimize = SVGO.default.optimize.bind(SVGO.default);
                SVGO_loaded = true;
                console.log('âœ“ SVGO å·²åŠ è½½ï¼ˆdefault exportï¼‰');
            }
        }
        // å°è¯•åˆ›å»ºå®ä¾‹
        else if (typeof SVGO === 'function') {
            try {
                const svgoInstance = new SVGO({});
                if (typeof svgoInstance.optimize === 'function') {
                    SVGO_optimize = svgoInstance.optimize.bind(svgoInstance);
                    SVGO_loaded = true;
                    console.log('âœ“ SVGO å·²åŠ è½½ï¼ˆå®ä¾‹åŒ–ï¼‰');
                }
            } catch (e) {
                console.warn('SVGO å®ä¾‹åŒ–å¤±è´¥:', e);
            }
        }
    }

    // å¦‚æœ SVGO æœªåŠ è½½ï¼Œä½¿ç”¨å¢å¼ºçš„æ¨¡æ‹Ÿä¼˜åŒ–å‡½æ•°
    if (!SVGO_optimize) {
        console.warn('âš  SVGO æœªåŠ è½½ï¼Œå°†ä½¿ç”¨å¢å¼ºçš„æ¨¡æ‹Ÿä¼˜åŒ–å‡½æ•°ï¼ˆå‹ç¼©ç‡å¯èƒ½è¾ƒä½ï¼‰');
        SVGO_optimize = mockOptimize;
    }
}

// ç«‹å³å°è¯•åˆå§‹åŒ–ï¼ˆå¦‚æœ SVGO å·²åŠ è½½ï¼‰
initSVGO();

// å¦‚æœæœªåŠ è½½ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯•ï¼ˆç»™ CDN åŠ è½½æ—¶é—´ï¼‰
if (!SVGO_loaded) {
    setTimeout(initSVGO, 500);
    setTimeout(initSVGO, 2000);
}

// --- DOM å…ƒç´ å¼•ç”¨ ---
const uploadZone = document.getElementById('uploadZone');
const fileInput = document.getElementById('fileInput');
const originalPreview = document.getElementById('originalPreview'); // Changed to container for <img>
const optimizedPreview = document.getElementById('optimizedPreview'); // Changed to container for <img>
const originalCode = document.getElementById('originalCode');
const optimizedCode = document.getElementById('optimizedCode');
const statsSection = document.getElementById('stats');
const originalSizeSpan = document.getElementById('originalSize');
const optimizedSizeSpan = document.getElementById('optimizedSize');
const savedSizeSpan = document.getElementById('savedSize');
const processTimeSpan = document.getElementById('processTime');
const previewContainer = document.getElementById('previewContainer');
const codeEditorContainer = document.getElementById('codeEditorContainer');
const actionButtons = document.getElementById('actionButtons');
const originalBadge = document.getElementById('originalBadge');
const optimizedBadge = document.getElementById('optimizedBadge');
const downloadOptimizedBtn = document.getElementById('downloadOptimized');
const downloadOriginalBtn = document.getElementById('downloadOriginal');
const copyOptimizedBtn = document.getElementById('copyOptimized');
const copyOriginalBtn = document.getElementById('copyOriginal'); // å·²ä¿®å¤
const loadNewBtn = document.getElementById('loadNew');
const notification = document.getElementById('notification');
const notificationText = document.getElementById('notificationText');
const resetOptionsBtn = document.getElementById('resetOptions');
const codeTabs = document.querySelectorAll('.code-tab');

// --- çŠ¶æ€å˜é‡ ---
let originalSvgString = '';
let optimizedSvgString = '';
let fileName = 'optimized.svg';

// é»˜è®¤ä¼˜åŒ–é€‰é¡¹ï¼ŒåŒ¹é… UI ä¸Šçš„å¤é€‰æ¡† ID
const defaultPlugins = {
    // åŸºç¡€ä¼˜åŒ–
    removeDoctype: true,
    removeXMLProcInst: true,
    removeComments: true,
    removeMetadata: true,
    removeEditorsNSData: true,

    // é«˜çº§ä¼˜åŒ–
    removeEmptyAttrs: true,
    removeHiddenElems: true,
    removeEmptyContainers: true,
    cleanupIDs: true,
    removeUselessDefs: true,
    cleanupNumericValues: true, // å…³é”®æ›´æ–°ï¼šæ–°å¢æ¸…ç†æ•°å­—å€¼é€‰é¡¹çš„é»˜è®¤çŠ¶æ€

    // è·¯å¾„ä¼˜åŒ–
    convertPathData: true,
    convertShapeToPath: false,
    mergePaths: true,
    precision: 3, // è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šé€‰é¡¹ï¼Œå½±å“ convertPathData å’Œ cleanupNumericValues

    // æ ·å¼ä¼˜åŒ–
    removeUnusedNS: true,
    cleanupAttrs: true,
    minifyStyles: true,
    removeStyleElement: false,

    // è¾“å‡ºæ ¼å¼
    prettyPrint: false, // æ˜¯å¦æ ¼å¼åŒ–è¾“å‡ºï¼ˆä¾¿äºé˜…è¯»ï¼‰
};

let currentOptions = { ...defaultPlugins };

// --- è¾…åŠ©å‡½æ•° ---

// å¢å¼ºçš„æ¨¡æ‹Ÿ SVGO ä¼˜åŒ–å‡½æ•°ï¼ˆå½“çœŸå® SVGO æœªåŠ è½½æ—¶ä½¿ç”¨ï¼‰
function mockOptimize(svgString, config) {
    let optimizedSvg = svgString;
    const precision = config.floatPrecision || 3;

    // è·å–å¯ç”¨çš„æ’ä»¶åˆ—è¡¨
    const plugins = config.plugins || [];
    const activePlugins = new Set(plugins.map(p => p.name || p));
    
    const getPluginParams = (name) => {
        const plugin = plugins.find(p => (p.name || p) === name);
        return plugin && plugin.params ? plugin.params : {};
    };

    // 1. ç§»é™¤æ³¨é‡Šï¼ˆé«˜ä¼˜å…ˆçº§ï¼Œé€šå¸¸èƒ½å‡å°‘å¾ˆå¤šç©ºé—´ï¼‰
    if (activePlugins.has('removeComments')) {
        optimizedSvg = optimizedSvg.replace(/<!--[\s\S]*?-->/g, '');
    }

    // 2. ç§»é™¤ DOCTYPE
    if (activePlugins.has('removeDoctype')) {
        optimizedSvg = optimizedSvg.replace(/<!DOCTYPE[\s\S]*?>/gi, '');
    }

    // 3. ç§»é™¤ XML å¤„ç†æŒ‡ä»¤
    if (activePlugins.has('removeXMLProcInst')) {
        optimizedSvg = optimizedSvg.replace(/<\?xml[\s\S]*?\?>/gi, '');
    }
    
    // 3.5. ç§»é™¤ SVG version å±æ€§ï¼ˆé»˜è®¤å€¼ï¼Œä¸éœ€è¦ï¼‰
    optimizedSvg = optimizedSvg.replace(/\s+version\s*=\s*["']1\.1["']/gi, '');
    
    // 3.6. ç§»é™¤æœªä½¿ç”¨çš„å‘½åç©ºé—´ï¼ˆå¦‚ xlinkï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨ï¼‰
    if (activePlugins.has('removeUnusedNS')) {
        // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº† xlink
        const hasXlinkUsage = /xlink:/i.test(optimizedSvg.replace(/xmlns:xlink[^>]*/gi, ''));
        if (!hasXlinkUsage) {
            optimizedSvg = optimizedSvg.replace(/\s+xmlns:xlink\s*=\s*["'][^"']*["']/gi, '');
        }
    }

    // 4. ç§»é™¤å…ƒæ•°æ®ï¼ˆmetadata æ ‡ç­¾ï¼‰
    if (activePlugins.has('removeMetadata')) {
        optimizedSvg = optimizedSvg.replace(/<metadata[\s\S]*?<\/metadata>/gi, '');
    }
    
    // 4.5. ç§»é™¤ title å’Œ descï¼ˆå¯é€‰ï¼Œå¦‚æœä¸éœ€è¦ SEOï¼‰
    // æ³¨æ„ï¼šè¿™é‡Œä¸ç§»é™¤ï¼Œå› ä¸ºå¯èƒ½å¯¹ SEO æœ‰ç”¨
    // å¦‚æœéœ€è¦ç§»é™¤ï¼Œå¯ä»¥æ·»åŠ é€‰é¡¹

    // 5. ç§»é™¤ç¼–è¾‘å™¨å‘½åç©ºé—´æ•°æ®
    if (activePlugins.has('removeEditorsNSData')) {
        optimizedSvg = optimizedSvg.replace(/\sxmlns:(?:sodipodi|inkscape|adobe|sketch|ai|corel|illustrator)="[^"]*"/gi, '');
    }

    // 6. ç§»é™¤ç©ºå±æ€§
    if (activePlugins.has('removeEmptyAttrs')) {
        optimizedSvg = optimizedSvg.replace(/\s+[a-zA-Z-]+="\s*"/g, '');
        optimizedSvg = optimizedSvg.replace(/\s+[a-zA-Z-]+='\s*'/g, '');
    }

    // 7. ç§»é™¤éšè—å…ƒç´ ï¼ˆdisplay:none æˆ– visibility:hiddenï¼‰
    if (activePlugins.has('removeHiddenElems')) {
        optimizedSvg = optimizedSvg.replace(/<[^>]+\s(?:display|visibility)\s*=\s*["'](?:none|hidden)["'][^>]*>[\s\S]*?<\/[^>]+>/gi, '');
    }

    // 8. ç§»é™¤ç©ºå®¹å™¨
    if (activePlugins.has('removeEmptyContainers')) {
        // å¤šæ¬¡å¤„ç†ä»¥ç§»é™¤åµŒå¥—çš„ç©ºå®¹å™¨
        let previousLength = 0;
        while (previousLength !== optimizedSvg.length) {
            previousLength = optimizedSvg.length;
            optimizedSvg = optimizedSvg.replace(/<g[^>]*>\s*<\/g>/gi, '');
            optimizedSvg = optimizedSvg.replace(/<g[^>]*>\s*<g[^>]*>\s*<\/g>\s*<\/g>/gi, ''); // åµŒå¥—ç©ºå®¹å™¨
        }
        optimizedSvg = optimizedSvg.replace(/<svg[^>]*>\s*<\/svg>/gi, '');
    }
    
    // 8.5. ç§»é™¤æœªä½¿ç”¨çš„ style ç±»ï¼ˆåœ¨ cleanupIDs ä¹‹å‰ï¼‰
    if (activePlugins.has('minifyStyles')) {
        // æ”¶é›†æ‰€æœ‰ä½¿ç”¨çš„ class
        const usedClasses = new Set();
        const classMatches = optimizedSvg.match(/\s+class\s*=\s*["']([^"']+)["']/gi);
        if (classMatches) {
            classMatches.forEach(match => {
                const classMatch = match.match(/["']([^"']+)["']/);
                if (classMatch) {
                    classMatch[1].split(/\s+/).forEach(cls => {
                        const trimmed = cls.trim();
                        if (trimmed) usedClasses.add(trimmed);
                    });
                }
            });
        }
        
        // ç§»é™¤æœªä½¿ç”¨çš„ CSS ç±»
        optimizedSvg = optimizedSvg.replace(/<style[^>]*>([\s\S]*?)<\/style>/gi, (match, styleContent) => {
            let cleaned = styleContent;
            // ç§»é™¤æœªä½¿ç”¨çš„ç±»å®šä¹‰
            const classDefRegex = /\.([a-zA-Z0-9_-]+)\s*\{[^}]*\}/g;
            cleaned = cleaned.replace(classDefRegex, (classDef, className) => {
                if (usedClasses.has(className)) {
                    return classDef;
                }
                return ''; // ç§»é™¤æœªä½¿ç”¨çš„ç±»
            });
            
            // å¦‚æœ style æ ‡ç­¾ä¸ºç©ºï¼Œç§»é™¤æ•´ä¸ª style æ ‡ç­¾
            if (cleaned.trim().length === 0) {
                return '';
            }
            
            return match.replace(styleContent, cleaned);
        });
    }

    // 9. æ¸…ç† IDï¼ˆç§»é™¤æœªä½¿ç”¨çš„ IDï¼‰
    if (activePlugins.has('cleanupIDs')) {
        // æ™ºèƒ½å®ç°ï¼šåªç§»é™¤æœªè¢«å¼•ç”¨çš„ ID
        // 1. æ”¶é›†æ‰€æœ‰ ID
        const idMatches = optimizedSvg.match(/\s+id\s*=\s*["']([^"']+)["']/gi);
        const allIds = new Set();
        if (idMatches) {
            idMatches.forEach(match => {
                const idMatch = match.match(/["']([^"']+)["']/);
                if (idMatch) {
                    allIds.add(idMatch[1]);
                }
            });
        }

        // 2. æ”¶é›†æ‰€æœ‰å¼•ç”¨çš„ IDï¼ˆåœ¨ url(#id)ã€href="#id"ã€xlink:href="#id" ç­‰ä¸­ï¼‰
        const referencedIds = new Set();
        const urlRefs = optimizedSvg.match(/url\(#([^)]+)\)/gi);
        const hrefRefs = optimizedSvg.match(/(?:href|xlink:href)\s*=\s*["']#([^"']+)["']/gi);
        const filterRefs = optimizedSvg.match(/filter\s*=\s*["']url\(#([^)]+)\)["']/gi);
        const fillRefs = optimizedSvg.match(/fill\s*=\s*["']url\(#([^)]+)\)["']/gi);
        const strokeRefs = optimizedSvg.match(/stroke\s*=\s*["']url\(#([^)]+)\)["']/gi);
        
        [urlRefs, hrefRefs, filterRefs, fillRefs, strokeRefs].forEach(refs => {
            if (refs) {
                refs.forEach(ref => {
                    const idMatch = ref.match(/#([^)"']+)/);
                    if (idMatch) {
                        referencedIds.add(idMatch[1]);
                    }
                });
            }
        });

        // 3. åªç§»é™¤æœªè¢«å¼•ç”¨çš„ ID
        allIds.forEach(id => {
            if (!referencedIds.has(id)) {
                // ç§»é™¤è¿™ä¸ªæœªä½¿ç”¨çš„ ID
                const idRegex = new RegExp(`\\s+id\\s*=\\s*["']${id.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}["']`, 'gi');
                optimizedSvg = optimizedSvg.replace(idRegex, '');
            }
        });
    }

    // 10. ç§»é™¤æ— ç”¨çš„ defsï¼ˆä½†ä¿ç•™æœ‰å¼•ç”¨çš„å†…å®¹ï¼‰
    if (activePlugins.has('removeUselessDefs')) {
        // å…ˆæ£€æŸ¥ defs ä¸­æ˜¯å¦æœ‰è¢«å¼•ç”¨çš„å†…å®¹
        const defsMatches = optimizedSvg.match(/<defs[^>]*>([\s\S]*?)<\/defs>/gi);
        if (defsMatches) {
            defsMatches.forEach(defsMatch => {
                const defsContent = defsMatch.match(/<defs[^>]*>([\s\S]*?)<\/defs>/i);
                if (defsContent && defsContent[1]) {
                    // æ£€æŸ¥å†…å®¹ä¸­æ˜¯å¦æœ‰è¢«å¼•ç”¨çš„ ID
                    const hasReferencedId = /id\s*=\s*["']([^"']+)["']/.test(defsContent[1]);
                    // æ£€æŸ¥è¿™ä¸ª ID æ˜¯å¦åœ¨ SVG çš„å…¶ä»–åœ°æ–¹è¢«å¼•ç”¨
                    if (hasReferencedId) {
                        const idMatch = defsContent[1].match(/id\s*=\s*["']([^"']+)["']/);
                        if (idMatch) {
                            const id = idMatch[1];
                            // æ£€æŸ¥è¿™ä¸ª ID æ˜¯å¦è¢«å¼•ç”¨
                            const isReferenced = new RegExp(`url\\(#${id.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}\\)`, 'i').test(optimizedSvg);
                            if (!isReferenced) {
                                // å¦‚æœ defs ä¸­çš„å†…å®¹æ²¡æœ‰è¢«å¼•ç”¨ï¼Œç§»é™¤æ•´ä¸ª defs
                                optimizedSvg = optimizedSvg.replace(defsMatch, '');
                            }
                        }
                    } else {
                        // å¦‚æœ defs ä¸­æ²¡æœ‰ IDï¼Œæ£€æŸ¥æ˜¯å¦ä¸ºç©º
                        const isEmpty = defsContent[1].trim().length === 0;
                        if (isEmpty) {
                            optimizedSvg = optimizedSvg.replace(defsMatch, '');
                        }
                    }
                }
            });
        }
    }

    // 11. æ¸…ç†æ•°å­—å€¼ï¼ˆä¼˜åŒ–ç²¾åº¦ï¼‰
    if (activePlugins.has('cleanupNumericValues')) {
        const floatPrecision = getPluginParams('cleanupNumericValues').floatPrecision || precision;
        // ä¼˜åŒ–å±æ€§ä¸­çš„æ•°å­—å€¼
        optimizedSvg = optimizedSvg.replace(/(\s[a-zA-Z-]+=["'])(\d+\.\d+)(["'])/g, (match, prefix, num, suffix) => {
            const optimized = parseFloat(num).toFixed(floatPrecision).replace(/\.?0+$/, '');
            return prefix + optimized + suffix;
        });
        // ä¼˜åŒ–è·¯å¾„ä¸­çš„æ•°å­—å€¼
        optimizedSvg = optimizedSvg.replace(/([dDmMlLhHvVcCsSqQtTaAzZ])\s*([-\d.]+)/g, (match, cmd, num) => {
            if (num.includes('.')) {
                const optimized = parseFloat(num).toFixed(floatPrecision).replace(/\.?0+$/, '');
                return cmd + optimized;
            }
            return match;
        });
    }

    // 12. ä¼˜åŒ–è·¯å¾„æ•°æ®
    if (activePlugins.has('convertPathData')) {
        const floatPrecision = getPluginParams('convertPathData').floatPrecision || precision;
        // ä¼˜åŒ–è·¯å¾„å‘½ä»¤ä¸­çš„æ•°å­—
        optimizedSvg = optimizedSvg.replace(/([dD])\s*=\s*["']([^"']+)["']/g, (match, cmd, pathData) => {
            // ä¼˜åŒ–è·¯å¾„æ•°æ®ä¸­çš„æµ®ç‚¹æ•°
            let optimized = pathData.replace(/([-\d.]+)/g, (num) => {
                if (num.includes('.')) {
                    return parseFloat(num).toFixed(floatPrecision).replace(/\.?0+$/, '');
                }
                return num;
            });
            
            // è¿›ä¸€æ­¥ä¼˜åŒ–ï¼šç§»é™¤è·¯å¾„å‘½ä»¤ä¹‹é—´çš„å¤šä½™ç©ºæ ¼
            // ä¾‹å¦‚ï¼šM 0,300 L 150,180 -> M0,300L150,180
            optimized = optimized
                .replace(/([MmLlHhVvCcSsQqTtAaZz])\s+/g, '$1') // å‘½ä»¤åç›´æ¥è·Ÿæ•°å­—
                .replace(/\s*,\s*/g, ',') // å‹ç¼©é€—å·å‘¨å›´çš„ç©ºæ ¼
                .replace(/\s+/g, ' ') // å‹ç¼©å¤šä¸ªç©ºæ ¼ä¸ºå•ä¸ªç©ºæ ¼
                .trim();
            
            return cmd + '="' + optimized + '"';
        });
    }

    // 13. ç§»é™¤æœªä½¿ç”¨çš„å‘½åç©ºé—´
    if (activePlugins.has('removeUnusedNS')) {
        // ç®€å•å®ç°ï¼šç§»é™¤å¸¸è§çš„æœªä½¿ç”¨å‘½åç©ºé—´
        optimizedSvg = optimizedSvg.replace(/\s+xmlns:[a-z]+="[^"]*"/gi, (match) => {
            // æ£€æŸ¥å‘½åç©ºé—´æ˜¯å¦åœ¨å†…å®¹ä¸­è¢«ä½¿ç”¨
            const nsMatch = match.match(/xmlns:([a-z]+)="([^"]*)"/i);
            if (nsMatch) {
                const nsPrefix = nsMatch[1];
                const nsRegex = new RegExp(nsPrefix + ':', 'i');
                if (!nsRegex.test(optimizedSvg.replace(/xmlns:[^=]*="[^"]*"/gi, ''))) {
                    return '';
                }
            }
            return match;
        });
    }

    // 14. æ¸…ç†å±æ€§
    if (activePlugins.has('cleanupAttrs')) {
        // ç§»é™¤å¤šä½™çš„ç©ºæ ¼
        optimizedSvg = optimizedSvg.replace(/\s+/g, ' ');
        // ç§»é™¤æ ‡ç­¾ä¹‹é—´çš„ç©ºæ ¼
        optimizedSvg = optimizedSvg.replace(/>\s+</g, '><');
        
        // ç§»é™¤æ— æ•ˆçš„ transformï¼ˆå¦‚ translate(0,0)ï¼‰
        optimizedSvg = optimizedSvg.replace(/\s+transform\s*=\s*["']translate\s*\(\s*0\s*,\s*0\s*\)["']/gi, '');
        optimizedSvg = optimizedSvg.replace(/\s+transform\s*=\s*["']translate\s*\(\s*0\.0+\s*,\s*0\.0+\s*\)["']/gi, '');
        
        // ç§»é™¤æ— æ•ˆçš„è·¯å¾„ï¼ˆå¦‚ M0,0 L0,0ï¼‰
        optimizedSvg = optimizedSvg.replace(/<path[^>]*\s+d\s*=\s*["']M\s*0\s*,\s*0\s*L\s*0\s*,\s*0["'][^>]*\/>/gi, '');
        
        // ç§»é™¤é»˜è®¤å­—ä½“å±æ€§
        optimizedSvg = optimizedSvg.replace(/\s+font-weight\s*=\s*["']normal["']/gi, '');
        optimizedSvg = optimizedSvg.replace(/\s+font-style\s*=\s*["']normal["']/gi, '');
        
        // ç§»é™¤ fill="none" stroke="none" çš„è·¯å¾„ï¼ˆæ— æ•ˆè·¯å¾„ï¼‰
        optimizedSvg = optimizedSvg.replace(/<path[^>]*\s+fill\s*=\s*["']none["'][^>]*\s+stroke\s*=\s*["']none["'][^>]*\/>/gi, '');
        
        // ç®€åŒ–å•ä½ï¼ˆpx å¯ä»¥çœç•¥ï¼‰
        optimizedSvg = optimizedSvg.replace(/(width|height|font-size|x|y|cx|cy|r|rx|ry)\s*=\s*["'](\d+)\.0+px["']/gi, '$1="$2"');
        optimizedSvg = optimizedSvg.replace(/(width|height|font-size|x|y|cx|cy|r|rx|ry)\s*=\s*["'](\d+)px["']/gi, '$1="$2"');
    }

    // 15. å‹ç¼©æ ·å¼ï¼ˆåŒ…æ‹¬å†…è”æ ·å¼ï¼‰
    if (activePlugins.has('minifyStyles')) {
        // å‹ç¼© <style> æ ‡ç­¾ä¸­çš„æ ·å¼
        optimizedSvg = optimizedSvg.replace(/<style[^>]*>([\s\S]*?)<\/style>/gi, (match, styleContent) => {
            let minified = styleContent
                .replace(/\/\*[\s\S]*?\*\//g, '') // ç§»é™¤æ³¨é‡Š
                .replace(/\s+/g, ' ') // å‹ç¼©å¤šä¸ªç©ºç™½ä¸ºå•ä¸ªç©ºæ ¼
                .trim();
            
            // å‹ç¼© CSS è§„åˆ™ï¼ˆæ›´æ™ºèƒ½çš„æ–¹å¼ï¼‰
            minified = minified
                .replace(/\s*{\s*/g, '{') // å‹ç¼©å¤§æ‹¬å·å‰çš„ç©ºç™½
                .replace(/\s*}\s*/g, '}') // å‹ç¼©å¤§æ‹¬å·åçš„ç©ºç™½
                .replace(/\s*,\s*/g, ',') // å‹ç¼©é€—å·å‘¨å›´çš„ç©ºç™½ï¼ˆé€‰æ‹©å™¨ä¸­çš„é€—å·ï¼‰
                // å¤„ç†å±æ€§å€¼ï¼šä¿ç•™å¿…è¦çš„ç©ºæ ¼ï¼ˆå¦‚ "0.3s ease", "Arial, sans-serif"ï¼‰
                .replace(/:\s*([^;{}]+?)(\s*[;}]|$)/g, (m, value, ending) => {
                    const trimmedValue = value.trim();
                    // å¦‚æœå€¼åŒ…å«å¤šä¸ªå•è¯ï¼ˆç”¨ç©ºæ ¼åˆ†éš”ï¼‰ï¼Œä¿ç•™å•ä¸ªç©ºæ ¼
                    // ä¾‹å¦‚ï¼š"0.3s ease", "Arial, sans-serif", "12px"
                    const optimized = trimmedValue.replace(/\s+/g, ' ');
                    return ':' + optimized + ending;
                })
                .replace(/;\s*}/g, '}') // ç§»é™¤æœ€åä¸€ä¸ªåˆ†å·
                .replace(/;\s+/g, ';') // å‹ç¼©åˆ†å·åçš„ç©ºç™½
                .replace(/\s+/g, ' ') // å†æ¬¡å‹ç¼©å¤šä¸ªç©ºç™½
                .trim();
            
            return match.replace(styleContent, minified);
        });
        
        // å‹ç¼©å†…è” style å±æ€§
        optimizedSvg = optimizedSvg.replace(/style\s*=\s*["']([^"']+)["']/gi, (match, styleContent) => {
            const minified = styleContent
                .replace(/\s+/g, ' ') // å‹ç¼©ç©ºç™½
                .replace(/:\s+/g, ':') // å‹ç¼©å†’å·
                .replace(/;\s+/g, ';') // å‹ç¼©åˆ†å·
                .trim();
            return `style="${minified}"`;
        });
        
        // ä¼˜åŒ–ï¼šå°†ç®€å•çš„å†…è”æ ·å¼è½¬æ¢ä¸ºå±æ€§ï¼ˆæé«˜å‹ç¼©ç‡ï¼‰
        // ä¾‹å¦‚ï¼šstyle="stop-color:#667eea;stop-opacity:1" -> stop-color="#667eea" stop-opacity="1"
        optimizedSvg = optimizedSvg.replace(/<(\w+)([^>]*)\s+style\s*=\s*["']([^"']+)["']([^>]*)>/gi, (match, tagName, beforeStyle, styleContent, afterStyle) => {
            // åªå¤„ç†ç®€å•çš„æ ·å¼ï¼ˆä¸åŒ…å«å¤æ‚é€‰æ‹©å™¨æˆ–å‡½æ•°ï¼‰
            if (!styleContent.includes('(') && !styleContent.includes('url') && styleContent.split(';').length <= 5) {
                const stylePairs = styleContent.split(';').filter(s => s.trim());
                const attributes = [];
                let hasComplexStyle = false;
                
                stylePairs.forEach(pair => {
                    const [key, value] = pair.split(':').map(s => s.trim());
                    if (key && value) {
                        // æ£€æŸ¥æ˜¯å¦æ˜¯ SVG æ ‡å‡†å±æ€§
                        const svgAttributes = ['fill', 'stroke', 'stroke-width', 'opacity', 'stop-color', 'stop-opacity', 'fill-opacity', 'stroke-opacity'];
                        if (svgAttributes.includes(key) || key.startsWith('stop-')) {
                            attributes.push(`${key}="${value}"`);
                        } else {
                            hasComplexStyle = true;
                        }
                    }
                });
                
                // å¦‚æœæ‰€æœ‰æ ·å¼éƒ½å¯ä»¥è½¬æ¢ä¸ºå±æ€§ï¼Œåˆ™è½¬æ¢
                if (!hasComplexStyle && attributes.length > 0 && attributes.length === stylePairs.length) {
                    const newAttributes = beforeStyle + ' ' + attributes.join(' ') + afterStyle;
                    return `<${tagName}${newAttributes}>`;
                }
            }
            return match;
        });
    }

    // 16. ç§»é™¤ style å…ƒç´ 
    if (activePlugins.has('removeStyleElement')) {
        optimizedSvg = optimizedSvg.replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '');
    }

    // 17. åˆå¹¶è·¯å¾„ï¼ˆç®€å•å®ç°ï¼‰
    if (activePlugins.has('mergePaths')) {
        // è¿™ä¸ªåŠŸèƒ½æ¯”è¾ƒå¤æ‚ï¼Œç®€å•å®ç°ï¼šç§»é™¤é‡å¤çš„ç©ºæ ¼å’Œæ¢è¡Œ
        optimizedSvg = optimizedSvg.replace(/\s+/g, ' ');
    }

    // æœ€ç»ˆæ¸…ç†ï¼šç§»é™¤å¤šä½™ç©ºç™½å’Œæ¢è¡Œ
    optimizedSvg = optimizedSvg
        .replace(/>\s+</g, '><') // ç§»é™¤æ ‡ç­¾ä¹‹é—´çš„ç©ºç™½
        .replace(/\s+/g, ' ') // å‹ç¼©å¤šä¸ªç©ºç™½ä¸ºå•ä¸ªç©ºæ ¼
        .replace(/\s*=\s*/g, '=') // å‹ç¼©ç­‰å·å‘¨å›´çš„ç©ºç™½
        .replace(/\s*>\s*/g, '>') // å‹ç¼©ç»“æŸæ ‡ç­¾å‰çš„ç©ºç™½
        .replace(/\s*<\s*/g, '<') // å‹ç¼©å¼€å§‹æ ‡ç­¾åçš„ç©ºç™½
        .trim();
    
    // é¢å¤–ä¼˜åŒ–ï¼šç§»é™¤é»˜è®¤å€¼ï¼ˆå¦‚æœå¯ç”¨ minifyStylesï¼‰
    if (activePlugins.has('minifyStyles')) {
        // ç§»é™¤ opacity="1"ï¼ˆé»˜è®¤å€¼ï¼‰
        optimizedSvg = optimizedSvg.replace(/\s+opacity\s*=\s*["']1["']/gi, '');
        // ç§»é™¤ stop-opacity="1"ï¼ˆé»˜è®¤å€¼ï¼‰
        optimizedSvg = optimizedSvg.replace(/\s+stop-opacity\s*=\s*["']1["']/gi, '');
        // ç§»é™¤ fill-opacity="1"ï¼ˆé»˜è®¤å€¼ï¼‰
        optimizedSvg = optimizedSvg.replace(/\s+fill-opacity\s*=\s*["']1["']/gi, '');
        // ç§»é™¤ stroke-opacity="1"ï¼ˆé»˜è®¤å€¼ï¼‰
        optimizedSvg = optimizedSvg.replace(/\s+stroke-opacity\s*=\s*["']1["']/gi, '');
        
        // ä¼˜åŒ–ï¼šç§»é™¤ polygon å’Œ polyline ä¸­ points å±æ€§çš„å¤šä½™ç©ºæ ¼
        optimizedSvg = optimizedSvg.replace(/points\s*=\s*["']([^"']+)["']/gi, (match, points) => {
            const optimized = points.replace(/\s*,\s*/g, ',').replace(/\s+/g, ' ').trim();
            return `points="${optimized}"`;
        });
    }
    
    // ä¼˜åŒ–åŠ¨ç”»å…ƒç´ çš„å€¼å±æ€§ï¼ˆå‹ç¼©ç©ºæ ¼ï¼‰
    // ä¾‹å¦‚ï¼švalues="1,200;100,200;100,200" -> values="1,200;100,200;100,200"ï¼ˆç§»é™¤å¤šä½™ç©ºæ ¼ï¼‰
    optimizedSvg = optimizedSvg.replace(/values\s*=\s*["']([^"']+)["']/gi, (match, values) => {
        const optimized = values.replace(/\s*;\s*/g, ';').replace(/\s*,\s*/g, ',').replace(/\s+/g, '').trim();
        return `values="${optimized}"`;
    });
    
    // ä¼˜åŒ– from/to å±æ€§ï¼ˆåŠ¨ç”»å˜æ¢å€¼ï¼‰
    optimizedSvg = optimizedSvg.replace(/(from|to)\s*=\s*["']([^"']+)["']/gi, (match, attr, value) => {
        const optimized = value.replace(/\s+/g, ' ').trim();
        return `${attr}="${optimized}"`;
    });
    
    // ä¼˜åŒ– SVG æ»¤é•œå…ƒç´ å±æ€§ï¼ˆå‹ç¼©æ•°å€¼ï¼‰
    // ä¾‹å¦‚ï¼šstdDeviation="3" -> stdDeviation="3"ï¼ˆå¦‚æœç²¾åº¦å…è®¸ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼‰
    // æ³¨æ„ï¼šæ»¤é•œå€¼é€šå¸¸éœ€è¦ä¿æŒç²¾åº¦ï¼Œæ‰€ä»¥è¿™é‡Œåªå‹ç¼©ç©ºæ ¼
    optimizedSvg = optimizedSvg.replace(/(stdDeviation|dx|dy|slope|k1|k2|k3|k4)\s*=\s*["']([^"']+)["']/gi, (match, attr, value) => {
        const optimized = value.replace(/\s+/g, '').trim();
        return `${attr}="${optimized}"`;
    });
    
    // ä¼˜åŒ–ï¼šç§»é™¤ç©ºçš„ feMergeNodeï¼ˆå¦‚æœæ²¡æœ‰ä»»ä½•å±æ€§ï¼‰
    optimizedSvg = optimizedSvg.replace(/<feMergeNode\s*\/>/gi, '<feMergeNode/>');

    return { data: optimizedSvg };
}


// æ ¼å¼åŒ–å­—èŠ‚å¤§å°
function formatBytes(bytes, decimals = 2) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const dm = decimals < 0 ? 0 : decimals;
    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
}

// æ˜¾ç¤ºé€šçŸ¥æ¶ˆæ¯
function showNotification(message, duration = 3000) {
    notificationText.textContent = message;
    notification.classList.add('show');
    setTimeout(() => {
        notification.classList.remove('show');
    }, duration);
}

// å°† SVG å­—ç¬¦ä¸²è½¬æ¢ä¸º Data URI
function svgToDataURI(svgString) {
    const encodedSvg = encodeURIComponent(svgString)
        .replace(/'/g, '%27') // é¿å…å•å¼•å·å¯¼è‡´ URI æŸå
        .replace(/"/g, '%22'); // é¿å…åŒå¼•å·å¯¼è‡´ URI æŸå
    return `data:image/svg+xml;utf8,${encodedSvg}`;
}

// --- æ ¸å¿ƒä¼˜åŒ–é€»è¾‘ ---
function applyOptimization() {
    if (!originalSvgString) return;

    const start = performance.now();

    try {
        // æ„é€  SVGO é…ç½®å¯¹è±¡
        // SVGO 4.0+ ä½¿ç”¨æ’ä»¶æ•°ç»„æ ¼å¼ï¼Œæ¯ä¸ªæ’ä»¶æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–å­—ç¬¦ä¸²
        const svgoPlugins = [];
        const precision = currentOptions.precision || 3;

        // éå†æ‰€æœ‰é€‰é¡¹ï¼Œæ„å»ºæ’ä»¶é…ç½®
        for (const key in currentOptions) {
            if (key === 'precision') continue; // precision æ˜¯å…¨å±€å‚æ•°

            const isEnabled = currentOptions[key];
            if (!isEnabled) continue; // è·³è¿‡æœªå¯ç”¨çš„æ’ä»¶

            // éœ€è¦ç‰¹æ®Šå‚æ•°çš„æ’ä»¶
            if (key === 'convertPathData' || key === 'cleanupNumericValues') {
                svgoPlugins.push({
                    name: key,
                    params: {
                        floatPrecision: precision,
                    }
                });
            } else {
                // å…¶ä»–æ’ä»¶ä½¿ç”¨é»˜è®¤é…ç½®
                svgoPlugins.push({
                    name: key
                });
            }
        }

        console.log('SVGO é…ç½®:', { plugins: svgoPlugins, precision });

        // è°ƒç”¨ SVGO ä¼˜åŒ–
        // SVGO API: optimize(svgString, config)
        // æ³¨æ„ï¼šSVGO 3.x ä½¿ç”¨ plugins æ•°ç»„ï¼Œ2.x å¯èƒ½ä½¿ç”¨ä¸åŒçš„æ ¼å¼
        const config = {
            plugins: svgoPlugins,
            multipass: true, // å¤šæ¬¡è¿è¡Œä¼˜åŒ–å™¨ä»¥è·å¾—æ›´å¥½çš„å‹ç¼©ç‡
            floatPrecision: precision, // å…¨å±€ç²¾åº¦è®¾ç½®
        };

        console.log('è°ƒç”¨ SVGO ä¼˜åŒ–ï¼Œé…ç½®:', config);
        const result = SVGO_optimize(originalSvgString, config);

        // å¤„ç†è¿”å›ç»“æœï¼ˆå¯èƒ½æ˜¯ Promise æˆ–ç›´æ¥ç»“æœï¼‰
        if (result && typeof result.then === 'function') {
            // å¼‚æ­¥å¤„ç†
            result.then((resolvedResult) => {
                optimizedSvgString = resolvedResult.data || resolvedResult;
                const end = performance.now();
                const processTime = (end - start).toFixed(2);
                updateUI(processTime);
            }).catch((error) => {
                console.error("SVG ä¼˜åŒ–å¤±è´¥:", error);
                showNotification("SVG ä¼˜åŒ–å¤±è´¥: " + (error.message || 'æœªçŸ¥é”™è¯¯'), 5000);
                optimizedSvgString = originalSvgString;
                updateUI(0);
            });
            return; // å¼‚æ­¥å¤„ç†ï¼Œæå‰è¿”å›
        } else {
            // åŒæ­¥å¤„ç†
            optimizedSvgString = result.data || result || originalSvgString;
        }
    } catch (e) {
        console.error("SVG ä¼˜åŒ–å¤±è´¥:", e);
        showNotification("SVG ä¼˜åŒ–å¤±è´¥: " + (e.message || 'æœªçŸ¥é”™è¯¯'), 5000);
        optimizedSvgString = originalSvgString;
    }

    const end = performance.now();
    const processTime = (end - start).toFixed(2);
    lastProcessTime = parseFloat(processTime);
    updateUI(processTime);
}

// SVG æ ¼å¼åŒ–å‡½æ•°ï¼ˆç¾åŒ–è¾“å‡ºï¼‰
function formatSVG(svgString) {
    if (!svgString) return '';
    
    let formatted = svgString;
    let indent = 0;
    const indentSize = 2; // ç¼©è¿›ç©ºæ ¼æ•°
    
    // åœ¨æ ‡ç­¾å‰åæ·»åŠ æ¢è¡Œå’Œç¼©è¿›
    formatted = formatted
        .replace(/></g, '>\n<') // åœ¨æ ‡ç­¾ä¹‹é—´æ·»åŠ æ¢è¡Œ
        .split('\n')
        .map(line => {
            const trimmed = line.trim();
            if (!trimmed) return '';
            
            // å‡å°‘ç¼©è¿›ï¼ˆç»“æŸæ ‡ç­¾ï¼‰
            if (trimmed.match(/^<\/[^>]+>/)) {
                indent = Math.max(0, indent - 1);
            }
            
            const indented = ' '.repeat(indent * indentSize) + trimmed;
            
            // å¢åŠ ç¼©è¿›ï¼ˆå¼€å§‹æ ‡ç­¾ï¼Œä½†ä¸æ˜¯è‡ªé—­åˆæ ‡ç­¾ï¼‰
            if (trimmed.match(/^<[^/!?][^>]*[^/]>/) && !trimmed.match(/\/>$/)) {
                indent++;
            }
            
            return indented;
        })
        .filter(line => line.trim()) // ç§»é™¤ç©ºè¡Œ
        .join('\n');
    
    return formatted;
}

// --- UI æ›´æ–°å‡½æ•° ---
function updateUI(processTime) {
    if (!originalSvgString || !optimizedSvgString) return;

    // è·å–æ ¼å¼åŒ–é€‰é¡¹
    const prettyPrint = currentOptions.prettyPrint || false;
    
    // å†³å®šæ˜¾ç¤ºçš„ä»£ç ï¼ˆæ ¼å¼åŒ–æˆ–å‹ç¼©ï¼‰
    const displayOptimized = prettyPrint ? formatSVG(optimizedSvgString) : optimizedSvgString;
    const displayOriginal = prettyPrint ? formatSVG(originalSvgString) : originalSvgString;

    // è®¡ç®—æ–‡ä»¶å¤§å°ï¼ˆä½¿ç”¨å®é™…å‹ç¼©åçš„ä»£ç ï¼Œä¸æ˜¯æ ¼å¼åŒ–çš„ï¼‰
    const originalSize = new Blob([originalSvgString]).size;
    const optimizedSize = new Blob([optimizedSvgString]).size; // ä½¿ç”¨å‹ç¼©åçš„å®é™…å¤§å°
    const savedSize = originalSize - optimizedSize;
    const savedPercent = originalSize > 0 ? ((savedSize / originalSize) * 100).toFixed(1) : 0;

    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    originalSizeSpan.textContent = formatBytes(originalSize);
    optimizedSizeSpan.textContent = formatBytes(optimizedSize);
    savedSizeSpan.textContent = `${formatBytes(savedSize)} (${savedPercent}%)`;
    processTimeSpan.textContent = `${processTime} ms`;

    // æ›´æ–°é¢„è§ˆåŒºåŸŸçš„å¤§å°æ ‡ç­¾
    originalBadge.textContent = formatBytes(originalSize);
    optimizedBadge.textContent = formatBytes(optimizedSize);

    // æ›´æ–°ä»£ç ç¼–è¾‘å™¨ï¼ˆæ˜¾ç¤ºæ ¼å¼åŒ–çš„ä»£ç ï¼‰
    originalCode.value = displayOriginal;
    optimizedCode.value = displayOptimized;

    // æ›´æ–°é¢„è§ˆï¼ˆä½¿ç”¨ Data URI é˜²æ­¢ XSSï¼Œä½¿ç”¨å®é™…å‹ç¼©åçš„ä»£ç ï¼‰
    const originalDataURI = svgToDataURI(originalSvgString);
    const optimizedDataURI = svgToDataURI(optimizedSvgString);

    originalPreview.innerHTML = `<img src="${originalDataURI}" alt="åŸå§‹ SVG" />`;
    optimizedPreview.innerHTML = `<img src="${optimizedDataURI}" alt="ä¼˜åŒ–å SVG" />`;

    // æ˜¾ç¤ºæ‰€æœ‰ç»“æœåŒºåŸŸ
    statsSection.classList.remove('hidden');
    previewContainer.classList.remove('hidden');
    codeEditorContainer.classList.remove('hidden');
    actionButtons.classList.remove('hidden');
}

// --- æ–‡ä»¶åŠ è½½é€»è¾‘ ---
function loadFile(file) {
    if (file.type !== 'image/svg+xml') {
        showNotification('è¯·ä¸Šä¼ æœ‰æ•ˆçš„ SVG æ–‡ä»¶ï¼');
        return;
    }

    // é™åˆ¶æ–‡ä»¶å¤§å°ï¼Œä¾‹å¦‚ 5MB
    const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB
    if (file.size > MAX_FILE_SIZE) {
        showNotification('æ–‡ä»¶è¿‡å¤§ï¼Œè¯·ä¸Šä¼ å°äº 5MB çš„ SVG æ–‡ä»¶ã€‚');
        return;
    }

    fileName = file.name;

    const reader = new FileReader();
    reader.onload = (e) => {
        originalSvgString = e.target.result;
        // éšè—ä¸Šä¼ åŒºåŸŸ
        uploadZone.classList.add('hidden');
        // æ˜¾ç¤ºé¢„è§ˆå’Œç»Ÿè®¡ä¿¡æ¯
        document.body.classList.add('svg-loaded'); // ç”¨äºè°ƒæ•´å¸ƒå±€ï¼Œå¦‚æœéœ€è¦
        applyOptimization(); // åŠ è½½åç«‹å³ä¼˜åŒ–
    };
    reader.onerror = () => {
        showNotification('è¯»å–æ–‡ä»¶å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚');
    };
    reader.readAsText(file);
}

// --- äº‹ä»¶ç›‘å¬å™¨ ---

// æ–‡ä»¶æ‹–æ”¾
uploadZone.addEventListener('dragover', (e) => {
    e.preventDefault(); // é˜»æ­¢é»˜è®¤è¡Œä¸ºä»¥å…è®¸æ‹–æ”¾
    uploadZone.classList.add('dragover');
});

uploadZone.addEventListener('dragleave', () => {
    uploadZone.classList.remove('dragover');
});

uploadZone.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadZone.classList.remove('dragover');
    if (e.dataTransfer.files.length > 0) {
        loadFile(e.dataTransfer.files[0]);
    }
});

// æ–‡ä»¶é€‰æ‹©
uploadZone.addEventListener('click', () => {
    fileInput.click();
});

fileInput.addEventListener('change', (e) => {
    if (e.target.files.length > 0) {
        loadFile(e.target.files[0]);
    }
});

// ä¼˜åŒ–é€‰é¡¹æ”¹å˜æ—¶é‡æ–°ä¼˜åŒ–
document.querySelectorAll('.sidebar input[type="checkbox"]').forEach(checkbox => {
    checkbox.addEventListener('change', (e) => {
        currentOptions[e.target.id] = e.target.checked;
        // å¦‚æœæ˜¯æ ¼å¼åŒ–é€‰é¡¹ï¼Œåªæ›´æ–° UIï¼Œä¸é‡æ–°ä¼˜åŒ–
        if (e.target.id === 'prettyPrint') {
            updateUI(lastProcessTime || 0);
        } else {
            applyOptimization();
        }
    });
});

document.getElementById('precision').addEventListener('change', (e) => {
    let value = parseInt(e.target.value, 10);
    // é™åˆ¶ç²¾åº¦åœ¨åˆç†èŒƒå›´
    if (isNaN(value) || value < 0) value = 0;
    if (value > 10) value = 10;
    e.target.value = value; // æ›´æ–° UI
    currentOptions.precision = value;
    applyOptimization();
});

// é‡ç½®é€‰é¡¹
resetOptionsBtn.addEventListener('click', () => {
    currentOptions = { ...defaultPlugins };
    for (const key in defaultPlugins) {
        const element = document.getElementById(key);
        if (element && element.type === 'checkbox') {
            element.checked = defaultPlugins[key];
        } else if (element && element.type === 'number') {
            element.value = defaultPlugins[key];
        }
    }
    applyOptimization();
    showNotification('ä¼˜åŒ–é€‰é¡¹å·²é‡ç½®ä¸ºé»˜è®¤å€¼ã€‚');
});

// ä¸‹è½½æŒ‰é’®
downloadOptimizedBtn.addEventListener('click', () => {
    if (!optimizedSvgString) {
        showNotification('æ²¡æœ‰å¯ä¸‹è½½çš„ä¼˜åŒ– SVGï¼');
        return;
    }
    const blob = new Blob([optimizedSvgString], { type: 'image/svg+xml' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = fileName.replace(/\.svg$/i, '.optimized.svg'); // ä¿æŒåŸå§‹æ–‡ä»¶åï¼Œå¢åŠ  .optimized
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    showNotification('ä¼˜åŒ–åçš„ SVG å·²ä¸‹è½½ï¼');
});

downloadOriginalBtn.addEventListener('click', () => {
    if (!originalSvgString) {
        showNotification('æ²¡æœ‰å¯ä¸‹è½½çš„åŸå§‹ SVGï¼');
        return;
    }
    const blob = new Blob([originalSvgString], { type: 'image/svg+xml' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = fileName;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    showNotification('åŸå§‹ SVG å·²ä¸‹è½½ï¼');
});

// å¤åˆ¶ä»£ç æŒ‰é’® (ä½¿ç”¨ Clipboard API)
copyOptimizedBtn.addEventListener('click', () => {
    if (optimizedSvgString) {
        navigator.clipboard.writeText(optimizedSvgString)
            .then(() => showNotification('ä¼˜åŒ–åçš„ SVG ä»£ç å·²å¤åˆ¶ï¼'))
            .catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                showNotification('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ã€‚');
            });
    } else {
        showNotification('æ²¡æœ‰å¯å¤åˆ¶çš„ä¼˜åŒ– SVG ä»£ç ï¼');
    }
});

copyOriginalBtn.addEventListener('click', () => {
    if (originalSvgString) {
        navigator.clipboard.writeText(originalSvgString)
            .then(() => showNotification('åŸå§‹ SVG ä»£ç å·²å¤åˆ¶ï¼'))
            .catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                showNotification('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ã€‚');
            });
    } else {
        showNotification('æ²¡æœ‰å¯å¤åˆ¶çš„åŸå§‹ SVG ä»£ç ï¼');
    }
});

// åŠ è½½æ–°æ–‡ä»¶
loadNewBtn.addEventListener('click', () => {
    originalSvgString = '';
    optimizedSvgString = '';
    fileName = 'optimized.svg';

    // éšè—æ‰€æœ‰ç»“æœåŒºåŸŸï¼Œæ˜¾ç¤ºä¸Šä¼ åŒºåŸŸ
    uploadZone.classList.remove('hidden');
    statsSection.classList.add('hidden');
    previewContainer.classList.add('hidden');
    codeEditorContainer.classList.add('hidden');
    actionButtons.classList.add('hidden');

    // æ¸…ç©ºé¢„è§ˆå’Œä»£ç å†…å®¹
    originalPreview.innerHTML = '';
    optimizedPreview.innerHTML = '';
    originalCode.value = '';
    optimizedCode.value = '';
    fileInput.value = ''; // æ¸…ç©ºæ–‡ä»¶è¾“å…¥æ¡†ï¼Œä»¥ä¾¿å†æ¬¡é€‰æ‹©ç›¸åŒæ–‡ä»¶
    document.body.classList.remove('svg-loaded'); // ç§»é™¤å¸ƒå±€è°ƒæ•´ç±»
    showNotification('è¯·é€‰æ‹©æ–°çš„ SVG æ–‡ä»¶ã€‚');
});

// ä»£ç ç¼–è¾‘å™¨ Tab åˆ‡æ¢
codeTabs.forEach(tab => {
    tab.addEventListener('click', () => {
        codeTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        const targetTab = tab.dataset.tab;
        if (targetTab === 'original') {
            document.getElementById('originalCode').classList.remove('hidden');
            document.getElementById('optimizedCode').classList.add('hidden');
        } else {
            document.getElementById('originalCode').classList.add('hidden');
            document.getElementById('optimizedCode').classList.remove('hidden');
        }
    });
});

// åˆå§‹åŒ–é€‰é¡¹çš„ UI çŠ¶æ€
function initializeOptionsUI() {
    for (const key in defaultPlugins) {
        const element = document.getElementById(key);
        if (element && element.type === 'checkbox') {
            element.checked = defaultPlugins[key];
        } else if (element && element.type === 'number') {
            element.value = defaultPlugins[key];
        }
    }
}

// å…¨å±€å˜é‡ç”¨äºå­˜å‚¨å¤„ç†æ—¶é—´ï¼ˆç”¨äºæ ¼å¼åŒ–é€‰é¡¹åˆ‡æ¢æ—¶ï¼‰
let lastProcessTime = 0;

// é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
document.addEventListener('DOMContentLoaded', initializeOptionsUI);

</script>
</body>
</html>
